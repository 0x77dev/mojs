<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - motion-path.coffee</title>

  <link rel="stylesheet" href="../assets/style.css">
  
    
      <style>
        
      </style>
    
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../"/>
  <meta name="groc-document-path" content="js/motion-path.coffee"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/legomushroom/mojs.git/blob/master/js/motion-path.coffee">js/motion-path.coffee</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
        <div class="code"><div class="wrapper">h         = <span class="hljs-built_in">require</span> <span class="hljs-string">'./h'</span>
resize    = <span class="hljs-built_in">require</span> <span class="hljs-string">'./vendor/resize'</span>
Timeline  = <span class="hljs-built_in">require</span> <span class="hljs-string">'./tween/timeline'</span>
Tween     = <span class="hljs-built_in">require</span> <span class="hljs-string">'./tween/tween'</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MotionPath</span></span>
  <span class="hljs-attribute">NS</span>: <span class="hljs-string">'http://www.w3.org/2000/svg'</span>
  <span class="hljs-attribute">defaults</span>:
    <span class="hljs-attribute">delay</span>:    <span class="hljs-number">0</span>
    <span class="hljs-attribute">duration</span>:         <span class="hljs-number">1000</span>
    <span class="hljs-attribute">easing</span>:           <span class="hljs-literal">null</span>
    <span class="hljs-attribute">repeat</span>:           <span class="hljs-number">0</span>
    <span class="hljs-attribute">yoyo</span>:             <span class="hljs-literal">false</span>
    <span class="hljs-attribute">offsetX</span>:          <span class="hljs-number">0</span>
    <span class="hljs-attribute">offsetY</span>:          <span class="hljs-number">0</span>
    <span class="hljs-attribute">angleOffset</span>:      <span class="hljs-literal">null</span>
    <span class="hljs-attribute">pathStart</span>:        <span class="hljs-number">0</span>
    <span class="hljs-attribute">pathEnd</span>:          <span class="hljs-number">1</span>
    <span class="hljs-attribute">transformOrigin</span>:  <span class="hljs-literal">null</span>

    <span class="hljs-attribute">curvature</span>:        <span class="hljs-attribute">y</span>: <span class="hljs-string">'50%'</span>, <span class="hljs-attribute">x</span>: <span class="hljs-string">'50%'</span>

    <span class="hljs-attribute">isAngle</span>:          <span class="hljs-literal">false</span>
    <span class="hljs-attribute">isReverse</span>:        <span class="hljs-literal">false</span>
    <span class="hljs-attribute">isRunLess</span>:        <span class="hljs-literal">false</span>
    <span class="hljs-attribute">isPresetPosition</span>: <span class="hljs-literal">true</span>

    <span class="hljs-attribute">onStart</span>:          <span class="hljs-literal">null</span>
    <span class="hljs-attribute">onComplete</span>:       <span class="hljs-literal">null</span>
    <span class="hljs-attribute">onUpdate</span>:         <span class="hljs-literal">null</span>

  <span class="hljs-attribute">constructor</span>:<span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@o</span>={})</span>-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@vars</span>(); <span class="hljs-property">@createTween</span>(); @

  <span class="hljs-attribute">vars</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@getScaler</span> = h.bind(<span class="hljs-property">@getScaler</span>, @); <span class="hljs-property">@resize</span> = resize
    <span class="hljs-property">@props</span> = h.cloneObj(<span class="hljs-property">@defaults</span>)
    <span class="hljs-property">@extendOptions</span> <span class="hljs-property">@o</span>
    <span class="hljs-property">@history</span> = [h.cloneObj(<span class="hljs-property">@props</span>)]
    <span class="hljs-property">@postVars</span>()
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments doc-section">
          <div class="wrapper"><p><span class='doc-section-header'>
Method <strong>curveToPath</strong>
</span></p>
<p>Method to transform coordinates and curvature
to svg path</p>
<p>Parameters:</p>
<ul>
<li><strong><code>coordinates</code> must be an Object.</strong><br/>(of end point <strong>x</strong> and <strong>y</strong>)</li>
<li><strong><code>coordinates</code> must be an Object.</strong><br/>(of the control point of the quadratic bezier curve, relative to start and end coordinates <strong>x</strong> and <strong>y</strong>)</li>
</ul>
<p><strong>Returns a SVGElement</strong><br/>(svg path)</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">curveToPath</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    path = <span class="hljs-built_in">document</span>.createElementNS <span class="hljs-property">@NS</span> , <span class="hljs-string">'path'</span>
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>start = x: 0, y: 0</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    end       = o.end
    start     = o.start
    finalEnd  = <span class="hljs-attribute">x</span>: start.x + end.x, <span class="hljs-attribute">y</span>: start.x + end.y
    curvature = o.curvature

    path.setAttribute <span class="hljs-string">'d'</span>, <span class="hljs-string">"M<span class="hljs-subst">#{start.x}</span>,<span class="hljs-subst">#{start.y}</span> Q0,0
       <span class="hljs-subst">#{finalEnd.x}</span>,<span class="hljs-subst">#{finalEnd.y}</span>"</span>
    path

  <span class="hljs-attribute">postVars</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@props</span>.pathStart = h.clamp <span class="hljs-property">@props</span>.pathStart, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>
    <span class="hljs-property">@props</span>.pathEnd   = h.clamp <span class="hljs-property">@props</span>.pathEnd, <span class="hljs-property">@props</span>.pathStart, <span class="hljs-number">1</span>
    <span class="hljs-property">@angle</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-property">@onUpdate</span>   = <span class="hljs-property">@props</span>.onUpdate
    <span class="hljs-property">@el</span>         = <span class="hljs-property">@parseEl</span> <span class="hljs-property">@props</span>.el
    <span class="hljs-property">@path</span>       = <span class="hljs-property">@getPath</span>()
    <span class="hljs-keyword">if</span> !<span class="hljs-property">@path</span>.getAttribute(<span class="hljs-string">'d'</span>)
      h.error(<span class="hljs-string">'Path has no coordinates to work with, aborting'</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    <span class="hljs-property">@len</span>        = <span class="hljs-property">@path</span>.getTotalLength()
    <span class="hljs-property">@slicedLen</span>  = <span class="hljs-property">@len</span>*(<span class="hljs-property">@props</span>.pathEnd - <span class="hljs-property">@props</span>.pathStart)
    <span class="hljs-property">@startLen</span>   = <span class="hljs-property">@props</span>.pathStart*<span class="hljs-property">@len</span>
    <span class="hljs-property">@fill</span>       = <span class="hljs-property">@props</span>.fill
    <span class="hljs-keyword">if</span> <span class="hljs-property">@fill</span>?
      <span class="hljs-property">@container</span>  = <span class="hljs-property">@parseEl</span> <span class="hljs-property">@props</span>.fill.container
      <span class="hljs-property">@fillRule</span>   = <span class="hljs-property">@props</span>.fill.fillRule <span class="hljs-keyword">or</span> <span class="hljs-string">'all'</span>
      <span class="hljs-property">@getScaler</span>()
      <span class="hljs-keyword">if</span> <span class="hljs-property">@container</span>?
        <span class="hljs-property">@removeEvent</span> <span class="hljs-property">@container</span>, <span class="hljs-string">'onresize'</span>, <span class="hljs-property">@getScaler</span>
        <span class="hljs-property">@addEvent</span>    <span class="hljs-property">@container</span>, <span class="hljs-string">'onresize'</span>, <span class="hljs-property">@getScaler</span>

  <span class="hljs-attribute">addEvent</span>:<span class="hljs-function"><span class="hljs-params">(el, type, handler)</span>-&gt;</span> el.addEventListener type, handler, <span class="hljs-literal">false</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if el.addEventListener then el.addEventListener type, handler, false
else if el.attachEvent then el.attachEvent type, handler</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">removeEvent</span>:<span class="hljs-function"><span class="hljs-params">(el, type, handler)</span>-&gt;</span> el.removeEventListener type, handler, <span class="hljs-literal">false</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments doc-section">
          <div class="wrapper"><p>if el.removeEventListener
  el.removeEventListener type, handler, false</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">parseEl</span>:<span class="hljs-function"><span class="hljs-params">(el)</span>-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.querySelector el <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> el <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
    <span class="hljs-keyword">return</span> el <span class="hljs-keyword">if</span> el <span class="hljs-keyword">instanceof</span> HTMLElement
    <span class="hljs-keyword">if</span> el.setProp? <span class="hljs-keyword">then</span> <span class="hljs-property">@isModule</span> = <span class="hljs-literal">true</span>; <span class="hljs-keyword">return</span> el

  <span class="hljs-attribute">getPath</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> <span class="hljs-property">@props</span>.path <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@props</span>.path.charAt(<span class="hljs-number">0</span>).toLowerCase() <span class="hljs-keyword">is</span> <span class="hljs-string">'m'</span>
        path = <span class="hljs-built_in">document</span>.createElementNS <span class="hljs-property">@NS</span>, <span class="hljs-string">'path'</span>
        path.setAttributeNS(<span class="hljs-literal">null</span>, <span class="hljs-string">'d'</span>, <span class="hljs-property">@props</span>.path); path
      <span class="hljs-keyword">else</span> <span class="hljs-built_in">document</span>.querySelector <span class="hljs-property">@props</span>.path</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>DOM node</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> <span class="hljs-property">@props</span>.path.style
      <span class="hljs-keyword">return</span> <span class="hljs-property">@props</span>.path
    <span class="hljs-keyword">if</span> <span class="hljs-property">@props</span>.path.x
      <span class="hljs-built_in">console</span>.log <span class="hljs-string">'a'</span>

  <span class="hljs-attribute">getScaler</span>:<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
    <span class="hljs-property">@cSize</span> =
      <span class="hljs-attribute">width</span>:  <span class="hljs-property">@container</span>.offsetWidth  <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
      <span class="hljs-attribute">height</span>: <span class="hljs-property">@container</span>.offsetHeight <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
    start = <span class="hljs-property">@path</span>.getPointAtLength <span class="hljs-number">0</span>
    end   = <span class="hljs-property">@path</span>.getPointAtLength <span class="hljs-property">@len</span>
    
    size = {}; <span class="hljs-property">@scaler</span> = {}
    size.width  = <span class="hljs-keyword">if</span> end.x &gt;= start.x <span class="hljs-keyword">then</span> end.x-start.x <span class="hljs-keyword">else</span> start.x-end.x
    size.height = <span class="hljs-keyword">if</span> end.y &gt;= start.y <span class="hljs-keyword">then</span> end.y-start.y <span class="hljs-keyword">else</span> start.y-end.y

    <span class="hljs-keyword">switch</span> <span class="hljs-property">@fillRule</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'all'</span>
        <span class="hljs-property">@calcWidth</span>(size); <span class="hljs-property">@calcHeight</span>(size)
      <span class="hljs-keyword">when</span> <span class="hljs-string">'width'</span>
        <span class="hljs-property">@calcWidth</span>(size);  <span class="hljs-property">@scaler</span>.y = <span class="hljs-property">@scaler</span>.x
      <span class="hljs-keyword">when</span> <span class="hljs-string">'height'</span>
        <span class="hljs-property">@calcHeight</span>(size); <span class="hljs-property">@scaler</span>.x = <span class="hljs-property">@scaler</span>.y</div></div>
      
      </div>
    
      <div class="segment">
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">calcWidth</span>:<span class="hljs-function"><span class="hljs-params">(size)</span>-&gt;</span>
    <span class="hljs-property">@scaler</span>.x = <span class="hljs-property">@cSize</span>.width/size.width
    !isFinite(<span class="hljs-property">@scaler</span>.x) <span class="hljs-keyword">and</span> (<span class="hljs-property">@scaler</span>.x = <span class="hljs-number">1</span>)
  <span class="hljs-attribute">calcHeight</span>:<span class="hljs-function"><span class="hljs-params">(size)</span>=&gt;</span>
    <span class="hljs-property">@scaler</span>.y = <span class="hljs-property">@cSize</span>.height/size.height
    !isFinite(<span class="hljs-property">@scaler</span>.y) <span class="hljs-keyword">and</span> (<span class="hljs-property">@scaler</span>.y = <span class="hljs-number">1</span>)

  <span class="hljs-attribute">run</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-keyword">if</span> o
      fistItem = <span class="hljs-property">@history</span>[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> o
        <span class="hljs-keyword">if</span> h.callbacksMap[key] <span class="hljs-keyword">or</span> h.tweenOptionMap[key]
          h.warn <span class="hljs-string">"the property \"<span class="hljs-subst">#{key}</span>\" property can not
            be overridden on run yet"</span>
          <span class="hljs-keyword">delete</span> o[key]
        <span class="hljs-keyword">else</span> <span class="hljs-property">@history</span>[<span class="hljs-number">0</span>][key] = value
      <span class="hljs-property">@tuneOptions</span> o
    <span class="hljs-property">@startTween</span>()

  <span class="hljs-attribute">createTween</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@timeline</span> = <span class="hljs-keyword">new</span> Timeline
      <span class="hljs-attribute">duration</span>:   <span class="hljs-property">@props</span>.duration
      <span class="hljs-attribute">delay</span>:      <span class="hljs-property">@props</span>.delay
      <span class="hljs-attribute">yoyo</span>:       <span class="hljs-property">@props</span>.yoyo
      <span class="hljs-attribute">repeat</span>:     <span class="hljs-property">@props</span>.repeat
      <span class="hljs-attribute">easing</span>:     <span class="hljs-property">@props</span>.easing
      <span class="hljs-attribute">onStart</span>:    <span class="hljs-function">=&gt;</span> <span class="hljs-property">@props</span>.onStart?.apply @
      <span class="hljs-attribute">onComplete</span>: <span class="hljs-function">=&gt;</span> <span class="hljs-property">@props</span>.onComplete?.apply @
      <span class="hljs-attribute">onUpdate</span>:  <span class="hljs-function"><span class="hljs-params">(p)</span>=&gt;</span> <span class="hljs-property">@setProgress</span>(p)
      <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">=&gt;</span> <span class="hljs-property">@history</span>.length &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@tuneOptions</span> <span class="hljs-property">@history</span>[<span class="hljs-number">0</span>]
    <span class="hljs-property">@tween</span> = <span class="hljs-keyword">new</span> Tween<span class="hljs-comment"># onUpdate:(p)=&gt; @o.onChainUpdate?(p)</span>
    <span class="hljs-property">@tween</span>.add(<span class="hljs-property">@timeline</span>)
    !<span class="hljs-property">@props</span>.isRunLess <span class="hljs-keyword">and</span> <span class="hljs-property">@startTween</span>()
    <span class="hljs-property">@props</span>.isPresetPosition <span class="hljs-keyword">and</span> <span class="hljs-property">@setProgress</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>)

  <span class="hljs-attribute">startTween</span>:<span class="hljs-function">-&gt;</span> setTimeout (<span class="hljs-function">=&gt;</span> <span class="hljs-property">@tween</span>?.start()), <span class="hljs-number">1</span>

  <span class="hljs-attribute">setProgress</span>:<span class="hljs-function"><span class="hljs-params">(p, isInit)</span>-&gt;</span>
    len = <span class="hljs-property">@startLen</span>+<span class="hljs-keyword">if</span> !<span class="hljs-property">@props</span>.isReverse <span class="hljs-keyword">then</span> p*<span class="hljs-property">@slicedLen</span> <span class="hljs-keyword">else</span> (<span class="hljs-number">1</span>-p)*<span class="hljs-property">@slicedLen</span>
    point = <span class="hljs-property">@path</span>.getPointAtLength len
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>get current angle</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> <span class="hljs-property">@props</span>.isAngle <span class="hljs-keyword">or</span> <span class="hljs-property">@props</span>.angleOffset?
      prevPoint = <span class="hljs-property">@path</span>.getPointAtLength len - <span class="hljs-number">1</span>
      x1 = point.y - prevPoint.y
      x2 = point.x - prevPoint.x
      atan = Math.atan(x1/x2); !isFinite(atan) <span class="hljs-keyword">and</span> (atan = <span class="hljs-number">0</span>)
      <span class="hljs-property">@angle</span> = atan*h.RAD_TO_DEG
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-property">@props</span>.angleOffset) <span class="hljs-keyword">isnt</span> <span class="hljs-string">'function'</span>
        <span class="hljs-property">@angle</span> += <span class="hljs-property">@props</span>.angleOffset <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
      <span class="hljs-keyword">else</span> <span class="hljs-property">@angle</span> = <span class="hljs-property">@props</span>.angleOffset.call @, <span class="hljs-property">@angle</span>, p
    <span class="hljs-keyword">else</span> <span class="hljs-property">@angle</span> = <span class="hljs-number">0</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>get x and y coordinates</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    x = point.x + <span class="hljs-property">@props</span>.offsetX; y = point.y + <span class="hljs-property">@props</span>.offsetY
    <span class="hljs-keyword">if</span> <span class="hljs-property">@scaler</span> <span class="hljs-keyword">then</span> x *= <span class="hljs-property">@scaler</span>.x; y *= <span class="hljs-property">@scaler</span>.y</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>set position and angle</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> <span class="hljs-property">@isModule</span> <span class="hljs-keyword">then</span> <span class="hljs-property">@setModulePosition</span>(x,y) <span class="hljs-keyword">else</span> <span class="hljs-property">@setElPosition</span>(x,y)</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>set transform origin</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> <span class="hljs-property">@props</span>.transformOrigin</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>transform origin could be a function</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      tOrigin = <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> <span class="hljs-property">@props</span>.transformOrigin <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
        <span class="hljs-property">@props</span>.transformOrigin(<span class="hljs-property">@angle</span>, p)
      <span class="hljs-keyword">else</span> <span class="hljs-property">@props</span>.transformOrigin
      <span class="hljs-property">@el</span>.style[<span class="hljs-string">"<span class="hljs-subst">#{h.prefix.css}</span>transform-origin"</span>] = tOrigin
      <span class="hljs-property">@el</span>.style[<span class="hljs-string">'transform-origin'</span>] = tOrigin
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>call onUpdate but not on the very first(0 progress) call</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    !isInit <span class="hljs-keyword">and</span> <span class="hljs-property">@onUpdate</span>?(p)

  <span class="hljs-attribute">setElPosition</span>:<span class="hljs-function"><span class="hljs-params">(x,y)</span>-&gt;</span>
    rotate = <span class="hljs-keyword">if</span> <span class="hljs-property">@angle</span> <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"rotate(<span class="hljs-subst">#{<span class="hljs-property">@angle</span>}</span>deg)"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>
    transform = <span class="hljs-string">"translate(<span class="hljs-subst">#{x}</span>px,<span class="hljs-subst">#{y}</span>px) <span class="hljs-subst">#{rotate}</span>"</span>
    <span class="hljs-property">@el</span>.style[<span class="hljs-string">"<span class="hljs-subst">#{h.prefix.css}</span>transform"</span>] = transform
    <span class="hljs-property">@el</span>.style[<span class="hljs-string">'transform'</span>] = transform
  <span class="hljs-attribute">setModulePosition</span>:<span class="hljs-function"><span class="hljs-params">(x, y)</span>-&gt;</span>
    <span class="hljs-property">@el</span>.setProp <span class="hljs-attribute">shiftX</span>: <span class="hljs-string">"<span class="hljs-subst">#{x}</span>px"</span>, <span class="hljs-attribute">shiftY</span>: <span class="hljs-string">"<span class="hljs-subst">#{y}</span>px"</span>, <span class="hljs-attribute">angle</span>: <span class="hljs-property">@angle</span>
    <span class="hljs-property">@el</span>.draw()

  <span class="hljs-attribute">extendDefaults</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> o
      @[key] = value
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>keys = Object.keys(o); len = keys.length
while(len--)
  @[keys[len]] = o[keys[len]]</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">extendOptions</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> o
      <span class="hljs-property">@props</span>[key] = value

  <span class="hljs-attribute">then</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    prevOptions = <span class="hljs-property">@history</span>[<span class="hljs-property">@history</span>.length-<span class="hljs-number">1</span>]; opts = {}
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> prevOptions</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>don&#39;t copy callbacks and tween options(only duration)
get prev options if not defined</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> !h.callbacksMap[key] <span class="hljs-keyword">and</span> !h.tweenOptionMap[key] <span class="hljs-keyword">or</span> key <span class="hljs-keyword">is</span> <span class="hljs-string">'duration'</span>
        o[key] ?= value</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if property is callback and not defined in then options -
define it as undefined :) to override old callback,
because we are inside the prevOptions hash and it means
the callback was previously defined</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">else</span> o[key] ?= <span class="hljs-literal">undefined</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>get tween timing values to feed the timeline</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> h.tweenOptionMap[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>copy all props, if prop is duration - fallback to previous value</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        opts[key] = <span class="hljs-keyword">if</span> key <span class="hljs-keyword">isnt</span> <span class="hljs-string">'duration'</span> <span class="hljs-keyword">then</span> o[key]
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> o[key]? <span class="hljs-keyword">then</span> o[key] <span class="hljs-keyword">else</span> prevOptions[key]
    <span class="hljs-property">@history</span>.push(o); it = @
    opts.onUpdate      = <span class="hljs-function"><span class="hljs-params">(p)</span>=&gt;</span> <span class="hljs-property">@setProgress</span> p
    opts.onStart       = <span class="hljs-function">=&gt;</span> <span class="hljs-property">@props</span>.onStart?.apply @
    opts.onComplete    = <span class="hljs-function">=&gt;</span> <span class="hljs-property">@props</span>.onComplete?.apply @
    opts.onFirstUpdate = <span class="hljs-function">-&gt;</span> it.tuneOptions it.history[<span class="hljs-property">@index</span>]
    opts.isChained = !o.delay
    <span class="hljs-property">@tween</span>.append <span class="hljs-keyword">new</span> Timeline(opts)
    @

  <span class="hljs-attribute">tuneOptions</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span> <span class="hljs-property">@extendOptions</span>(o); <span class="hljs-property">@postVars</span>()

<span class="hljs-built_in">module</span>.exports = MotionPath

</div></div>
      
      </div>
    
    </div>
  </div>

  <script src="../toc.js"></script>
  <script src="../assets/libs.js"></script>
  <script src="../assets/behavior.js"></script>

  
    
      <script>
        
      </script>
    
  
</body>
</html>